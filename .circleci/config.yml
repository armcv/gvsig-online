# This config was automatically generated from your source code
# Stacks detected: cicd:github-actions:.github/workflows,deps:python:gvsigol,file:manage.py:gvsigol
version: 2.1
orbs:
  cli: digitalocean/cli@0.1.1
jobs:
  - doctl/initialize:
      digitalocean-access-token: DO_TOKEN
  deploy:  
    # This is an example deploy job, not actually used by the workflow
    docker:
      - image: cimg/base:stable
    steps:
      # Replace this with steps to deploy to users
      - run:
          name: Docker build image
          command: docker build -t cullera_test_ubuntu .
      - run:
          name: login to registry
          command: doctl registry login
      - run:
          name: tag image
          command: docker tag cullera_test_ubuntu registry.digitalocean.com/cullera_test_ubuntu
      - run: 
          name: push image
          command: docker push registry.digitalocean.com/cullera_test_ubuntu
      - run:
          name: deploy image
          command: kubectl rollout restart deployment/gvsigonline-ubuntu
